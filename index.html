<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ุชูุฑูุฑ ุฃุญูุฏ ุณุงูู ุงููููู</title>

  <!-- ุฎุท Cairo -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f3f5f7;
      --card:#fff;
      --accent:#007bff;
      --success:#28a745;
      --muted:#777;
      --radius:12px;
    }
    body{
      font-family:"Cairo",sans-serif;
      background:var(--bg);
      margin:0;
      padding:28px;
      color:#222;
      -webkit-font-smoothing:antialiased;
    }

    .container{
      max-width:980px;
      margin:0 auto;
    }

    section.card{
      background:var(--card);
      border-radius:16px;
      box-shadow:0 6px 20px rgba(0,0,0,0.07);
      padding:26px;
    }

    h3{ margin:0 0 6px; font-size:22px; font-weight:700; color:#111; }
    small{ color:var(--muted); display:block; margin-bottom:12px; }

    .row { margin:14px 0; }
    label.inline{ display:block; cursor:pointer; font-size:15px; margin-bottom:8px; }
    input[type="date"]{
      width:220px; padding:8px 10px; border-radius:8px; border:1px solid #d6d6d6;
      font-family:"Cairo",sans-serif;
    }

    fieldset{
      border:1px solid #e6e6e6; padding:14px; border-radius:10px; background:#fafafa; margin-top:16px;
    }
    legend{ font-weight:600; padding:0 8px; color:#333; }

    label.inline > input[type="checkbox"]{ margin-left:8px; accent-color:var(--accent); }

    textarea.sub-input, input.table-input {
      display:none; /* shown when checkbox checked */
      width:100%; box-sizing:border-box;
      padding:8px 10px; border-radius:8px; border:1px solid #ddd;
      margin:8px 0 10px;
      font-family:"Cairo",sans-serif;
      font-size:14px;
    }

    textarea.sub-input.visible, input.table-input.visible { display:block; }

    .confirm-box{
      background:#f8f9fa; border:1px solid #eee; padding:12px; border-radius:10px; margin-top:14px; font-weight:600;
    }

    .actions{ margin-top:18px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
    button{
      cursor:pointer; border:none; padding:10px 18px; border-radius:10px; color:#fff; font-weight:600;
      font-family:"Cairo",sans-serif;
    }
    .btn-save{ background:var(--accent); }
    .btn-print{ background:var(--success); }

    .save-notice{
      text-align:center; margin-top:10px; color:var(--success); font-weight:700; opacity:0; transition:opacity .25s;
    }

    /* ุงูุฌุฏูู */
    table.metrics{
      width:100%; border-collapse:collapse; margin-top:8px;
    }
    table.metrics th, table.metrics td{ border:1px solid #e8e8e8; padding:8px 10px; text-align:right; vertical-align:top; }
    table.metrics th{ background:#fafafa; font-weight:700; }
    .metric-label { white-space:nowrap; font-weight:600; }

    /* ุทุจุงุนุฉ */
    @media print{
      body{ background:#fff; }
      .actions, .save-notice { display:none !important; }
      .card{ box-shadow:none; border:0; margin:0; padding: 0 0 20px 0; }
      /* force inputs & textareas to show */
      input[type="text"], input[type="date"], textarea { border: none; background: transparent; display:block !important; }
      .btn-print, .btn-save { display:none; }
    }

    @media (max-width:600px){
      input[type="date"]{ width:100%; }
      .actions{ flex-direction:column; }
    }

  </style>
</head>
<body>
  <div class="container">
    <section class="card" id="reportCard">
      <h3>๐งพ ูุงุฆูุฉ ููุงู ุฃุญูุฏ ุณุงูู โ ุงููุฏูุฑ ุงููุงูู โ ุงูุชูุฑูุฑ ุงููููู</h3>
      <small>ุฃุดุฑ ููุท ุนูู ุงูุจููุฏ ุงูุชู ุฃูุฌุฒุชูุง ุจููุณู ุงูููู. ุจุนุฏ ุงูุชุนููู ูุธูุฑ ูุฑุจุน ูููุต ุฃุณูู ูู ุจูุฏ ูุชูุชุจ ุงูุชูุงุตูู.</small>

      <div class="row">
        <label for="reportDate" style="display:block; margin-bottom:6px;">๐ ุชุงุฑูุฎ ุงูุชูุฑูุฑ</label>
        <input id="reportDate" name="report_date" type="date" />
      </div>

      <!-- ุงูุชูุงุฑูุฑ ูุงููุฑุงุฌุนุฉ ุงูููููุฉ -->
      <fieldset>
        <legend>ุงูุชูุงุฑูุฑ ูุงููุฑุงุฌุนุฉ ุงูููููุฉ</legend>

        <label class="inline"><input type="checkbox" value="bank_review"> ุฑุงุฌุนุช ูุดููุงุช ุงูุจููู</label>
        <textarea class="sub-input" id="bank_review_txt" placeholder="ุงุฐูุฑ ุงูุจููู/ุฃู ููุงุญุธุงุช ุงููุฑุงุฌุนุฉ"></textarea>

        <label class="inline"><input type="checkbox" value="zoho_reconciled"> ุชูุช ูุทุงุจูุฉ ุงูุฃุฑุตุฏุฉ ุฏุงุฎู Zoho</label>
        <textarea class="sub-input" id="zoho_reconciled_txt" placeholder="ุชูุงุตูู ุงููุทุงุจูุฉ ุฃู ุงููุฑููุงุช"></textarea>

        <label class="inline"><input type="checkbox" value="movements_checked"> ุฑุงุฌุนุช ุงูุญุฑูุงุช ุงูููููุฉ (ุงูุชุญูููุงุช + ุงูุฅูุฏุงุนุงุช)</label>
        <textarea class="sub-input" id="movements_checked_txt" placeholder="ุงุฐูุฑ ุงูุญุฑูุงุช ุฃู ููุงุญุธุงุช ูุงูุฉ"></textarea>

        <label class="inline"><input type="checkbox" value="vendor_invoices_recorded"> ุชุฃูุฏุช ูู ุชุณุฌูู ููุงุชูุฑ ุงูููุฑุฏูู ุงูุฌุฏูุฏุฉ</label>
        <textarea class="sub-input" id="vendor_invoices_recorded_txt" placeholder="ุฃุณูุงุก ุงูููุฑุฏูู ุฃู ุนุฏุฏ ุงูููุงุชูุฑ"></textarea>

        <label class="inline"><input type="checkbox" value="sales_invoices_linked"> ุชุฃูุฏุช ูู ุฑุจุท ููุงุชูุฑ ุงููุจูุนุงุช ุจุงูููุฑุฏูู/ุงูุฃุฑุตุฏุฉ</label>
        <textarea class="sub-input" id="sales_invoices_linked_txt" placeholder="ุชูุงุตูู ุงูุฑุจุท ุฃู ุงุณุชุซูุงุกุงุช"></textarea>

        <label class="inline"><input type="checkbox" value="pending_payments_followed"> ุชุงุจุนุช ุนูููุงุช ุงูุฏูุน ุงููุนููุฉ ุฃู ุงููุคุฌูุฉ</label>
        <textarea class="sub-input" id="pending_payments_followed_txt" placeholder="ุงุฐูุฑ ุงูุนูููุงุช ุงููุนููุฉ ุฃู ุงูุจููู ุงููุนููุฉ"></textarea>

        <label class="inline"><input type="checkbox" value="expenses_classified"> ุชุฃูุฏุช ูู ุชุตููู ุงููุตุฑููุงุช ุงูููููุฉ</label>
        <textarea class="sub-input" id="expenses_classified_txt" placeholder="ููุงุญุธุงุช ุญูู ุชุตููู ุงููุตุฑููุงุช"></textarea>
      </fieldset>

      <!-- ุงูุชุญููู ุงููุงูู -->
      <fieldset>
        <legend>ุงูุชุญููู ุงููุงูู</legend>
        <label class="inline"><input type="checkbox" value="cash_flow_summary"> ุฃุนุฏุฏุช ููุฎุต ุงูููุจูุถุงุช ูุงููุฏููุนุงุช ุงูููููุฉ</label>
        <textarea class="sub-input" id="cash_flow_summary_txt" placeholder="ููุฎุต ุงูููุจูุถุงุช/ุงููุฏููุนุงุช"></textarea>

        <label class="inline"><input type="checkbox" value="vendors_balance_tracked"> ุชุงุจุนุช ุงูุฑุตูุฏ ุงูุฅุฌูุงูู ููููุฑุฏูู</label>
        <textarea class="sub-input" id="vendors_balance_tracked_txt" placeholder="ููุงุญุธุงุช ุญูู ุฃุฑุตุฏุฉ ุงูููุฑุฏูู"></textarea>

        <label class="inline"><input type="checkbox" value="revenue_vs_target"> ูุงุฑูุช ุงูุฅูุฑุงุฏุงุช ุจุงููุณุชูุฏู ุงูุดูุฑู</label>
        <textarea class="sub-input" id="revenue_vs_target_txt" placeholder="ูุณุจุฉ ุงูุฅูุฌุงุฒ ููุงุจู ุงููุณุชูุฏู"></textarea>

        <label class="inline"><input type="checkbox" value="daily_growth_rate"> ุฑุงูุจุช ูุณุจุฉ ุงูููู ุงููููู ูู ุงููุจูุนุงุช</label>
        <textarea class="sub-input" id="daily_growth_rate_txt" placeholder="ูุนุฏู ุงูููู ููุงุฑูุฉ ุจููู/ุฃุณุจูุน ุณุงุจู"></textarea>
      </fieldset>

      <!-- ุงูุฅุดุฑุงู ูุงููุชุงุจุนุฉ -->
      <fieldset>
        <legend>ุงูุฅุดุฑุงู ูุงููุชุงุจุนุฉ</legend>
        <label class="inline"><input type="checkbox" value="freelancer_reviewed"> ุฑุงุฌุนุช ุนูู ุงููุฑููุงูุณุฑ ูุชุฃูุฏุช ูู ุฏูุฉ ุงูุฅุฏุฎุงูุงุช</label>
        <textarea class="sub-input" id="freelancer_reviewed_txt" placeholder="ุชูุงุตูู ุงููุฑุงุฌุนุฉ"></textarea>

        <label class="inline"><input type="checkbox" value="accounting_corrections"> ุตุญุญุช ุฃู ุนุฏููุช ุจูุงูุงุช ูุญุงุณุจูุฉ ุฎุงุทุฆุฉ</label>
        <textarea class="sub-input" id="accounting_corrections_txt" placeholder="ุงุฐูุฑ ููุน ุงูุฃุฎุทุงุก ุงูุชู ุชู ุชุตุญูุญูุง"></textarea>

        <label class="inline"><input type="checkbox" value="intercompany_followup"> ุชุงุจุนุช ุงูุนูููุงุช ุงููุงููุฉ ุจูู ุงููุฑูุน</label>
        <textarea class="sub-input" id="intercompany_followup_txt" placeholder="ุชูุงุตูู ุงูุนูููุงุช ุฃู ููุงุญุธุงุช"></textarea>

        <label class="inline"><input type="checkbox" value="bank_communications"> ุชูุงุตูุช ูุน ุงูุจููู ุจุดุฃู ุนูููุงุช ุฃู ุงุณุชูุณุงุฑุงุช</label>
        <textarea class="sub-input" id="bank_communications_txt" placeholder="ุงุฐูุฑ ุงูุจูู ูุณุจุจ ุงูุชูุงุตู"></textarea>
      </fieldset>

      <!-- ุงูุชูุงุฑูุฑ ุงูุฅุฏุงุฑูุฉ + ุฎุทุฉ ุงูุบุฏ -->
      <fieldset>
        <legend>ุงูุชูุงุฑูุฑ ุงูุฅุฏุงุฑูุฉ</legend>
        <label class="inline"><input type="checkbox" value="slack_report_sent"> ุฃุฑุณูุช ุงูุชูุฑูุฑ ุงููููู ูู ููุงุฉ Slack #CFO_CEO</label>
        <textarea class="sub-input" id="slack_report_sent_txt" placeholder="ููุช ุงูุฅุฑุณุงู ุฃู ููุงุญุธุงุช"></textarea>

        <label class="inline"><input type="checkbox" value="improvement_notes_added"> ุฃุถูุช ููุงุญุธุงุช ููุชุญุณูู ุฃู ุชูุจููุงุช ูุงููุฉ</label>
        <textarea class="sub-input" id="improvement_notes_added_txt" placeholder="ุฃูู ุงูููุงุญุธุงุช ุฃู ุงูุชูุจููุงุช"></textarea>

        <label class="inline"><input type="checkbox" value="tomorrow_plan_written" id="tomorrowPlanChk"> ุฎุทุฉ ุนูู ุงูุบุฏ</label>
        <textarea class="sub-input" id="tomorrow_plan_txt" placeholder="ุงูุชุจ ุฎุทุฉ ุนูู ุงูุบุฏ ุจุงูุชูุตูู"></textarea>
      </fieldset>

      <fieldset>
        <legend>ูุงุฐุง ููุฌุฏ ุนูู ุฌุฏูู ุงูุงุนูุงู ุบุฏุงู ุ</legend>

        <label class="inline"><input type="checkbox" value="tomorrow_plan_written" id="tomorrowPlanChk"> ุฎุทุฉ ุนูู ุงูุบุฏ</label>
        <textarea class="sub-input" id="tomorrow_plan_txt" placeholder="ุงูุชุจ ุฎุทุฉ ุนูู ุงูุบุฏ ุจุงูุชูุตูู"></textarea>
      </fieldset>

      <!-- ุฌุฏูู ุงูููุงููุณ ุงููุทููุจ -->
      <fieldset>
        <legend>ูุคุดุฑุงุช ุณุฑูุนุฉ (ููุงููุณ ุงูููู)</legend>

        <table class="metrics" aria-label="ููุงููุณ ุงูููู">
          <thead>
            <tr>
              <th style="width:38%">ุงููุคุดุฑ</th>
              <th style="width:18%">ุงููููุฉ</th>
              <th>ุงูููุงุญุธุงุช</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="metric-label">๐ต ุฅุฌูุงูู ุงูููุจูุถุงุช ุงูููู</td>
              <td><input id="metric_total_collected_value" class="table-input visible" type="text" placeholder="ูุซุงู: 45,200 ุฑูุงู"></td>
              <td><input id="metric_total_collected_notes" class="table-input visible" type="text" placeholder="ูุซุงู: ุจูุงุจุงุช ุงูุฏูุน ูุงูุจููู"></td>
            </tr>

            <tr>
              <td class="metric-label">๐งพ ุนุฏุฏ ููุงุชูุฑ ุงูููุฑุฏูู ุงููุณุฌูุฉ</td>
              <td><input id="metric_vendor_invoices_value" class="table-input visible" type="text" placeholder="ูุซุงู: 18"></td>
              <td><input id="metric_vendor_invoices_notes" class="table-input visible" type="text" placeholder="ูุซุงู: HAWA, Party Star"></td>
            </tr>

            <tr>
              <td class="metric-label">๐ฆ ุนุฏุฏ ูุดูู ุงูุจููู ุงูุชู ุชูุช ูุฑุงุฌุนุชูุง</td>
              <td><input id="metric_bank_statements_value" class="table-input visible" type="text" placeholder="ูุซุงู: 3"></td>
              <td><input id="metric_bank_statements_notes" class="table-input visible" type="text" placeholder="ูุซุงู: ุงูุนุฑุจู - ุงูุฃููู - ุงูุฅููุงุก"></td>
            </tr>

            <tr>
              <td class="metric-label">๐ ูุณุจุฉ ุงูุชุทุงุจู ุจูู Zoho ูุงูุจููู (%)</td>
              <td><input id="metric_zoho_match_value" class="table-input visible" type="text" placeholder="ูุซุงู: 98.7%"></td>
              <td><input id="metric_zoho_match_notes" class="table-input visible" type="text" placeholder="ููุงุญุธุงุช ุญูู ุงููุฑู ุฅู ููุฌุฏ"></td>
            </tr>

            <tr>
              <td class="metric-label">โฑ ุณุฑุนุฉ ุฅููุงู ุงูุนูููุงุช ุงูููููุฉ (ุณุงุนุงุช)</td>
              <td><input id="metric_closing_speed_value" class="table-input visible" type="text" placeholder="ูุซุงู: 2.3"></td>
              <td><input id="metric_closing_speed_notes" class="table-input visible" type="text" placeholder="ููุงุญุธุงุช ุญูู ุฃุณุจุงุจ ุงูุจุทุก ุฃู ุงูุชุญุณูู"></td>
            </tr>

            <tr>
              <td class="metric-label">๐ ูุณุจุฉ ุงูููู ุงููููู ูู ุงูุฅูุฑุงุฏุงุช (%)</td>
              <td><input id="metric_daily_growth_value" class="table-input visible" type="text" placeholder="ูุซุงู: +2.1%"></td>
              <td><input id="metric_daily_growth_notes" class="table-input visible" type="text" placeholder="ููุงุฑูุฉ ุจููู ุฃูุณ"></td>
            </tr>

            <tr>
              <td class="metric-label">๐ ุนุฏุฏ ุงูููุงุชูุฑ ุงููุนููุฉ ุฃู ุงููุคุฌูุฉ</td>
              <td><input id="metric_pending_invoices_value" class="table-input visible" type="text" placeholder="ูุซุงู: 2"></td>
              <td><input id="metric_pending_invoices_notes" class="table-input visible" type="text" placeholder="ูุซุงู: ุจุงูุชุธุงุฑ ุงุนุชูุงุฏ ููุฑุฏ"></td>
            </tr>

            <tr>
              <td class="metric-label">๐งฎ ุนุฏุฏ ุงูุฃุฎุทุงุก ุงููุญุงุณุจูุฉ ุงููุตุญุญุฉ ุงูููู</td>
              <td><input id="metric_errors_fixed_value" class="table-input visible" type="text" placeholder="ูุซุงู: 0"></td>
              <td><input id="metric_errors_fixed_notes" class="table-input visible" type="text" placeholder="ููุงุญุธุงุช ุฅู ููุฌุฏุช"></td>
            </tr>
          </tbody>
        </table>
      </fieldset>

      <div class="confirm-box">
        <label><input id="confirmByAhmad" type="checkbox"> ุฃุคูุฏ ุฃู ุงูุจููุฏ ุงููุคุดุฑุฉ ุฃุนูุงู ุชูุช ูุฑุงุฌุนุชู/ุชูููุฐู ููุง ุดุฎุตููุง ุงูููู.</label>
      </div>

      <div class="actions">
        <button class="btn-save" id="manualSaveBtn">๐พ ุญูุธ ูุญูู</button>
        <button class="btn-print" id="printBtn">๐จ๏ธ ุทุจุงุนุฉ / ุญูุธ PDF</button>
      </div>

      <div class="save-notice" id="saveNotice">ุชู ุงูุญูุธ ูุญููุงู โ</div>

    </section>
  </div>

  <script>
    // ููุงุชูุญ ุงูุญูุธ - ุชุณุงุนุฏ ุนูู ุชูุธูู ุงูุชุฎุฒูู
    const STORAGE_PREFIX = 'daily_report_';

    document.addEventListener('DOMContentLoaded', () => {
      const dateEl = document.getElementById('reportDate');

      // ุชุนุจุฆุฉ ุงูุชุงุฑูุฎ ุชููุงุฆูุงู ุฅุฐุง ูู ููู ูุญููุธุงู
      const savedDate = localStorage.getItem(STORAGE_PREFIX + 'reportDate');
      if (dateEl) {
        if (savedDate) {
          dateEl.value = savedDate;
        } else if (!dateEl.value) {
          const today = new Date();
          dateEl.value = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
        }
        dateEl.addEventListener('change', saveState);
      }

      // ุฑุจุท ูู checkbox ูุงุธูุงุฑ/ุงุฎูุงุก textarea ุงูุฐู ูููู
      document.querySelectorAll('input[type="checkbox"]').forEach(chk => {
        const label = chk.closest('label');
        // textarea ูุฏ ุชููู ุจุนุฏ ุงู label ูุจุงุดุฑุฉ
        const next = label ? label.nextElementSibling : null;

        // ุงุณุชุฑุฌุงุน ุญุงูุฉ ุงูู checkbox ุฅู ููุฌุฏุช
        const keyChk = STORAGE_PREFIX + 'chk_' + (chk.value || chk.id || Math.random());
        const storedChk = localStorage.getItem(keyChk);
        if (storedChk !== null) {
          chk.checked = storedChk === 'true';
        }

        // ุงุธูุงุฑ/ุงุฎูุงุก ุงููุฑุจุน ุงููุตู ุงููุฑุชุจุท (ูู ูุฌุฏ)
        if (next && (next.tagName === 'TEXTAREA' || next.classList.contains('sub-input'))) {
          next.classList.toggle('visible', chk.checked);
        }

        // ุญุฏุซ ุชุบูุฑ ุงูู checkbox
        chk.addEventListener('change', () => {
          if (next && (next.tagName === 'TEXTAREA' || next.classList.contains('sub-input'))) {
            next.classList.toggle('visible', chk.checked);
          }
          // ุญูุธ ุชููุงุฆู
          saveState();
        });
      });

      // ุงุณุชุฑุฌุงุน ูู ุงููุตูุต ูุงููุฏุฎูุงุช (textarea, input[type=text]) ูู localStorage
      document.querySelectorAll('textarea, input[type="text"], input[type="date"]').forEach(el => {
        const id = el.id;
        if (!id) return;
        const stored = localStorage.getItem(STORAGE_PREFIX + id);
        if (stored !== null) el.value = stored;

        // ุนูุฏ ุงููุชุงุจุฉ ุงุญูุธ ุชููุงุฆูุงู
        el.addEventListener('input', debounce(saveState, 400));
      });

      // ุงุณุชุฑุฌุงุน ุญุงูุฉ ุชุฃููุฏ ุงููุฏูุฑ (checkbox)
      const confirmChk = document.getElementById('confirmByAhmad');
      if (confirmChk) {
        const storedC = localStorage.getItem(STORAGE_PREFIX + 'confirmByAhmad');
        if (storedC !== null) confirmChk.checked = storedC === 'true';
        confirmChk.addEventListener('change', saveState);
      }

      // ุฒุฑ ุงูุญูุธ ุงููุฏูู
      const manualSaveBtn = document.getElementById('manualSaveBtn');
      if (manualSaveBtn) manualSaveBtn.addEventListener('click', () => {
        saveState();
        showSavedNotice();
      });

      // ุฒุฑ ุงูุทุจุงุนุฉ
      const printBtn = document.getElementById('printBtn');
      if (printBtn) printBtn.addEventListener('click', () => {
        // ุชุฃูุฏ ูู ุนุฑุถ ูู ุงูุญููู ุงููุฎุชููุฉ ูุจู ุงูุทุจุงุนุฉ
        revealAllForPrint();
        setTimeout(() => window.print(), 150);
      });

      // ุนูุฏ ุงูุชุญูููุ ุงุถุจุท ุธููุฑ ูุฑุจุนุงุช ุงููุต ุจูุงุก ุนูู ุงูููู ุงููุฎุฒูุฉ
      toggleAllSubInputsFromStorage();

      // ุญูุธ ุฃููู (ูุง ูุถุฑ)
      // saveState(); // ุบูุฑ ูุทููุจ ููุฑูุงู
    });

    // ุญูุธ ุงูุญุงูุฉ ุจุงููุงูู
    function saveState(){
      try {
        // ุญูุธ ุงูุชุงุฑูุฎ
        const dateEl = document.getElementById('reportDate');
        if (dateEl) localStorage.setItem(STORAGE_PREFIX + 'reportDate', dateEl.value);

        // ุญูุธ ูู checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(chk => {
          const keyChk = STORAGE_PREFIX + 'chk_' + (chk.value || chk.id || '');
          localStorage.setItem(keyChk, chk.checked);
        });

        // ุญูุธ ุงููุตูุต (textarea & inputs)
        document.querySelectorAll('textarea, input[type="text"], input[type="date"]').forEach(el => {
          if (!el.id) return;
          localStorage.setItem(STORAGE_PREFIX + el.id, el.value);
        });

        // ุชุฎุฒูู ุญุงูุฉ confirm
        const confirmChk = document.getElementById('confirmByAhmad');
        if (confirmChk) localStorage.setItem(STORAGE_PREFIX + 'confirmByAhmad', confirmChk.checked);

        // ุงุธูุงุฑ ุฑุณุงูุฉ ุญูุธ ูุตูุฑุฉ
        showSavedNotice();
      } catch (e) {
        console.error('Save error', e);
      }
    }

    // ุงุธูุงุฑ ุฑุณุงูุฉ "ุชู ุงูุญูุธ" ูุตูุฑุฉ
    function showSavedNotice(){
      const n = document.getElementById('saveNotice');
      if (!n) return;
      n.style.opacity = '1';
      clearTimeout(n._t);
      n._t = setTimeout(()=> n.style.opacity = '0', 1400);
    }

    // ุชุจุฏูู ูุฑุฆู ููู ุงููุฑุจุนุงุช (ุงุณุชุฑุฌุงุน ูู ุงูุชุฎุฒูู)
    function toggleAllSubInputsFromStorage(){
      document.querySelectorAll('input[type="checkbox"]').forEach(chk => {
        const label = chk.closest('label');
        const next = label ? label.nextElementSibling : null;
        const keyChk = STORAGE_PREFIX + 'chk_' + (chk.value || chk.id || '');
        const storedChk = localStorage.getItem(keyChk);
        if (storedChk !== null) {
          chk.checked = storedChk === 'true';
        }
        if (next && (next.tagName === 'TEXTAREA' || next.classList.contains('sub-input'))) {
          next.classList.toggle('visible', chk.checked);
        }
      });
    }

    // ุนุฑุถ ูู ุงูุญููู ูุจู ุงูุทุจุงุนุฉ (ุญุชู ูู ูุฎููุฉ)
    function revealAllForPrint(){
      // ุนุฑุถ ุฌููุน ุงูู textareas ุงููุคูุชุฉ
      document.querySelectorAll('textarea.sub-input').forEach(t => t.classList.add('visible'));
      // ุนุฑุถ ูู inputs ูู ุงูุฌุฏูู
      document.querySelectorAll('input.table-input').forEach(i => i.classList.add('visible'));
    }

    // Debounce util
    function debounce(fn, wait){
      let t;
      return function(...args){
        clearTimeout(t);
        t = setTimeout(()=> fn.apply(this, args), wait);
      };
    }
  </script>
</body>
</html>
